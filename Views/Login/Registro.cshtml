@{
	ViewData["Title"] = "Registro de Sesión";
}

<!DOCTYPE html>
<html lang="es">
<title>@ViewData["Title"]</title>
<link rel="stylesheet" href="~/css/Registro.css" />

<div class="row justify-content-center" id="fondoLogin">
	<div class="col-lg-6">
		<div class="card p-5 border border-dark" id="tarjetaBase">
			<div class="card-header border border-secondary text-center fs-3">
				Registrarse
			</div>
			<div class="card-body border border-secondary">
				<!--modificar mas adelante este formulario, para que cree un usuario nuevo (el controller sera diferente, por ahora usa el mismo de LoginController)-->
				<form id="login-form" method="post" asp-action="Login" asp-controller="Login" onsubmit="checkEmptyFields(event)" class="">

					<input class="form-control mb-1  border border-light text-xl-start" type="text" placeholder="Direccion" id="direccion" name="direccion" value="" />
					<div id="direcError" class="error-message form-text mb-1">
						La direccion debe escribirse bien, sino los pedidos NO llegarán.
					</div>

					<input class="form-control mb-1  border border-light text-xl-start" type="text" placeholder="E-mail" id="email" name="email" value="" />
					<div id="emailError" class="error-message form-text mb-1">
						El email no tiene mayusculas, debe llevar un arroba y un ".com" .
					</div>

					<input class="form-control mb-1  border border-light text-xl-start" type="text" placeholder="Nombres" id="nombre" name="nombre" value="" />
					<div id="nombresError" class="error-message form-text mb-1">
						Escribir los nombres y apellidos separados.
					</div>

					<input class="form-control mb-1  border border-light text-xl-start" type="number" placeholder="Telefono" id="telefono" name="telefono" />
					<div id="telefError" class="error-message form-text mb-1">
						Los telefonos solo tienen numeros, minimo 7 y max 13 (en el Perú solo son 9).
					</div>

					<input class="form-control mb-1  border border-light text-xl-start" type="text" placeholder="Nombre_usuario" id="username" name="username" oninput="validateInputs()" />
					<div id="usernameError" class="error-message form-text mb-1">
						El usuario nuevo debe tener mínimo 9 y 255 maximo.
					</div>

					<input class="form-control mb-1  border border-light text-xl-start" type="password" placeholder="Contraseña" id="password" name="password" oninput="validateInputs()" />
					<div id="passwordError" class="error-message form-text">
						La contraseña debe tener al menos 8 caracteres, incluir al menos una letra mayúscula, una letra minúscula y un número.
					</div>

					<div class="container-lg justify-content-center mt-3">
						<div class="d-grid gap-2 mb-3">
							<button class="btn btn-primary fs-5" type="submit" id="submitButton" disabled>Crear cuenta</button>
						</div>
						<div class="d-grid gap-2">
							<button class="btn btn-danger fs-5" id="buttomCancelar" type="button" onclick="goBack()">Cancelar</button>
						</div>
					</div>

				</form>
			</div>
		</div>
	</div>
</div>
<script>
	function validateInputs() {
		const username = document.getElementById('username').value;
		const password = document.getElementById('password').value;
		const submitButton = document.getElementById('submitButton');
		const usernameError = document.getElementById('usernameError');
		const passwordError = document.getElementById('passwordError');

		// Validar que el usuario tenga entre 9 y 255 caracteres
		const usernamePattern = /^[a-zA-Z0-9]{9,255}$/;

		// Validar que la contraseña tenga al menos 8 caracteres, incluya al menos una letra mayúscula, una letra minúscula y un número
		const passwordPattern = /^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)[A-Za-z\d]{8,}$/;

		let isValid = true;

		if (!usernamePattern.test(username)) {
			usernameError.style.display = 'block';
			isValid = false;
		} else {
			usernameError.style.display = 'none';
		}

		if (!passwordPattern.test(password)) {
			passwordError.style.display = 'block';
			isValid = false;
		} else {
			passwordError.style.display = 'none';
		}

		submitButton.disabled = !isValid;
	}

	function checkEmptyFields(event) {
		const username = document.getElementById('username').value;
		const password = document.getElementById('password').value;

		if (username.trim() === '' || password.trim() === '') {
			alert('Debe completar ambos campos.');
			event.preventDefault();
		}
	}

	function goBack() {
		window.history.back(); 
	}
</script>
<script src="~/lib/jquery/dist/jquery.min.js"></script>
<script src="~/lib/bootstrap/dist/js/bootstrap.bundle.min.js"></script>
</html>